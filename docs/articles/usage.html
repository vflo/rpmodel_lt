<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running the P-model in R • rpmodel</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet">
<meta property="og:title" content="Running the P-model in R">
<meta property="og:description" content="rpmodel">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://computationales.ethz.ch/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://computationales.ethz.ch/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>rpmodel <small>v1.2.2</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/functional_dependencies.html">Summary of functional dependencies</a>
    </li>
    <li>
      <a href="../articles/usage.html">Running the P-model in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/computationales/rpmodel/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running the P-model in R</h1>
                        <h4 data-toc-skip class="author">Beni
Stocker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/computationales/rpmodel/blob/HEAD/vignettes/usage.Rmd" class="external-link"><code>vignettes/usage.Rmd</code></a></small>
      <div class="hidden name"><code>usage.Rmd</code></div>

    </div>

    
    
<p>The rpmodel package implements the P-model as described in Stocker et
al. (2019) <em>Geosci. Mod. Dev.</em> The main function available
through the package is <code><a href="../reference/rpmodel.html">rpmodel()</a></code>, which returns a list of
quantities (see <code><a href="../reference/rpmodel.html">?rpmodel</a></code>) for a given set of inputs. An
additional set of important functions that are used within
<code><a href="../reference/rpmodel.html">rpmodel()</a></code> are also available through this package. Usage
examples are given below.</p>
<p><strong>Important note:</strong></p>
<p>The P-model predicts how photosynthesis acclimates to a changing
environment, coordinating stomatal conductance, Vcmax and Jmax. This
yields a model that has the form of a light use efficiency model, where
gross primary production scales linearly with absorbed light, as
described in <a href="https://doi.org/10.5194/gmd-13-1545-2020" class="external-link">Stocker
et al. 2020</a>. It is important to note that this implies that the
P-model is valid only for simulating responses to the environment that
evolve over the time scale at which the photosynthetic machinery (e.g.,
Rubisco) can be assumed to acclimate. Sensible choices are on the order
of a couple of weeks to a month. In other words, the arguments (climatic
forcing), provided to <code><a href="../reference/rpmodel.html">rpmodel()</a></code> should represent typical
daytime mean values, averaged across a couple of weeks. The output is
then representative also for average values across the same time
scale.</p>
<div class="section level2">
<h2 id="example-p-model-run">Example P-model run<a class="anchor" aria-label="anchor" href="#example-p-model-run"></a>
</h2>
<p>Let’s run the P-model, without <span class="math inline">\(J_{\text{max}}\)</span> limitation (argument
<code>method_jmaxlim = "none"</code>), for one point. The set of inputs,
being temperature (<code>tc</code>), photosynthetic photon flux density
(<code>ppfd</code>), vapour pressure deficit (<code>vpd</code>), ambient
CO<span class="math inline">\(_2\)</span> (<code>co2</code>), elevation
(<code>elv</code>), and fraction of absorbed photosynthetically active
radiation (<code>fapar</code>). The quantum yield efficiency parameter
is provided as an argument (<code>kphio</code>) and corresponds to <span class="math inline">\(\widehat{\varphi_0}\)</span> in Stocker et
al. (2019) if the temperature-dependence of this parameter is ignored
(argument <code>do_ftemp_kphio = FALSE</code>, corresponding to
simulation setup ‘ORG’ in Stocker et al. (2019)), or to <span class="math inline">\(\widehat{c_L}\)</span> if the
temperature-dependence of the quantum yield efficiency is included
(argument <code>do_ftemp_kphio = TRUE</code>, used in simulation setups
‘BRC’ and ‘FULL’ in Stocker et al. (2019)). By default the optional
argument <code>do_soilmstress</code> is set to <code>FALSE</code>,
meaning that the empirical soil moisture stress function is not
included. The unit cost ratio (<span class="math inline">\(\beta\)</span> in Stocker et al. (2019)) is given
by argument <code>beta</code>.</p>
<p>To run the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> function we can do:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/computationales/rpmodel" class="external-link">rpmodel</a></span><span class="op">)</span></span>
<span><span class="va">out_pmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  kphio          <span class="op">=</span> <span class="fl">0.049977</span>,     <span class="co"># quantum yield efficiency as calibrated for setup ORG by Stocker et al. 2020 GMD,</span></span>
<span>  beta           <span class="op">=</span> <span class="fl">146</span>,          <span class="co"># unit cost ratio a/b,</span></span>
<span>  c4             <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method_jmaxlim <span class="op">=</span> <span class="st">"wang17"</span>,</span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">FALSE</span>,        <span class="co"># corresponding to setup ORG</span></span>
<span>  do_soilmstress <span class="op">=</span> <span class="cn">FALSE</span>,        <span class="co"># corresponding to setup ORG</span></span>
<span>  verbose        <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in rpmodel(tc = 20, vpd = 1000, co2 = 400, fapar = 1, ppfd = 30, : Atmospheric pressure (patm) not provided. Calculating it as a</span></span>
<span><span class="co">##       function of elevation (elv), assuming standard atmosphere </span></span>
<span><span class="co">##       (101325 Pa at sea level).</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out_pmodel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $gpp</span></span>
<span><span class="co">## [1] 7.119192</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ca</span></span>
<span><span class="co">## [1] 40.53</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $gammastar</span></span>
<span><span class="co">## [1] 3.339251</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $kmm</span></span>
<span><span class="co">## [1] 46.09928</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ns_star</span></span>
<span><span class="co">## [1] 1.125361</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $chi</span></span>
<span><span class="co">## [1] 0.694352</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $xi</span></span>
<span><span class="co">## [1] 63.3145</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mj</span></span>
<span><span class="co">## [1] 0.7123038</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mc</span></span>
<span><span class="co">## [1] 0.3340838</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ci</span></span>
<span><span class="co">## [1] 28.14209</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $iwue</span></span>
<span><span class="co">## [1] 7.742446</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $gs</span></span>
<span><span class="co">## [1] 0.04784805</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vcmax</span></span>
<span><span class="co">## [1] 1.774218</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vcmax25</span></span>
<span><span class="co">## [1] 2.78494</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $jmax</span></span>
<span><span class="co">## [1] 4.001452</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $jmax25</span></span>
<span><span class="co">## [1] 5.464979</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $rd</span></span>
<span><span class="co">## [1] 0.02818463</span></span></code></pre>
<p>Above, we specified the model paramters (arguments <code>beta</code>
and <code>kphio</code>). This overrides the defaults, where
<code><a href="../reference/rpmodel.html">rpmodel()</a></code> uses the parameters as calibrated by Stocker et
al. (2019), depending on the choices for arguments
<code>do_ftemp_kphio</code> and <code>do_soilmstress</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kphio</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">do_ftemp_kphio</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">do_soilmstress</span>, <span class="fl">0.087182</span>, <span class="fl">0.081785</span><span class="op">)</span>, <span class="fl">0.049977</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">=</span> <span class="fl">146.0</span></span>
<span><span class="va">apar_soilm</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span><span class="va">bpar_soilm</span> <span class="op">=</span> <span class="fl">0.73300</span></span></code></pre></div>
<p>The function returns a list of variables (see also man page by
<code><a href="../reference/rpmodel.html">?rpmodel</a></code>), including <span class="math inline">\(V_{\mathrm{cmax}}\)</span>, <span class="math inline">\(g_s\)</span>, and all the parameters of the
photosynthesis model (<span class="math inline">\(K\)</span>, <span class="math inline">\(\Gamma^{\ast}\)</span>), which are all internally
consistent, as can be verified for…</p>
<p><span class="math display">\[
c_i = c_a - A / g_s = \chi c_a
\]</span></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_molmass</span> <span class="op">&lt;-</span> <span class="fl">12.0107</span>  <span class="co"># molecular mass of carbon</span></span>
<span><span class="va">kphio</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>         <span class="co"># quantum yield efficiency, value as used in the function call to rpmodel()</span></span>
<span><span class="va">ppfd</span> <span class="op">&lt;-</span> <span class="fl">30</span>            <span class="co"># mol/m2/d, value as used in the function call to rpmodel()</span></span>
<span><span class="va">fapar</span> <span class="op">&lt;-</span> <span class="fl">1</span>            <span class="co"># fraction, value as used in the function call to rpmodel()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">ci</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 28.14209</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">ca</span> <span class="op">-</span> <span class="op">(</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">gpp</span> <span class="op">/</span> <span class="va">c_molmass</span><span class="op">)</span> <span class="op">/</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gs</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 28.14209</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">ca</span> <span class="op">*</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">chi</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 28.14209</span></span></code></pre>
<p>Yes.</p>
<p>And for… <span class="math display">\[
A = V_{\text{cmax}} \frac{c_i-\Gamma^{\ast}}{c_i + K} = \phi_0
I_{\text{abs}} \frac{c_i-\Gamma^{\ast}}{c_i + 2 \Gamma^{\ast}} = g_s
(c_a - c_i)
\]</span></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gpp</span> <span class="op">/</span> <span class="va">c_molmass</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5927375</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">vcmax</span> <span class="op">*</span> <span class="op">(</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">ci</span> <span class="op">-</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gammastar</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">ci</span> <span class="op">+</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">kmm</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5927375</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gs</span> <span class="op">*</span> <span class="op">(</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">ca</span> <span class="op">-</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">ci</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.5927375</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">kphio</span> <span class="op">*</span> <span class="va">ppfd</span> <span class="op">*</span> <span class="va">fapar</span> <span class="op">*</span> <span class="op">(</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">ci</span> <span class="op">-</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gammastar</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">ci</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gammastar</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.068456</span></span></code></pre>
<p>Yes.</p>
<div class="section level3">
<h3 id="elevation-and-pressure">Elevation and pressure<a class="anchor" aria-label="anchor" href="#elevation-and-pressure"></a>
</h3>
<p>Above, atmospheric pressure (<code>patm</code>) was not provided as
an argument, but elevation (<code>elv</code>) was. Hence the warning was
printed (only when <code>verbose = TRUE</code>), saying:
<code>Atmospheric pressure (patm) not provided. Calculating it as a function of elevation (elv),</code>
<code>Assuming standard atmosphere (101325 Pa at sea level).</code>.
Alternatively, we can provide atmospheric pressure (<code>patm</code>)
as input, which overrides the argument <code>elv</code>.</p>
</div>
<div class="section level3">
<h3 id="p-model-for-time-series">P-model for time series<a class="anchor" aria-label="anchor" href="#p-model-for-time-series"></a>
</h3>
<p>The <code><a href="../reference/rpmodel.html">rpmodel()</a></code> function can also be invoked for time
series, where <code>tc</code>, <code>vpd</code>, <code>co2</code>,
<code>fapar</code>, <code>patm</code>, and <code>ppfd</code> are
vectors.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1982</span><span class="op">)</span></span>
<span><span class="va">out_ts_pmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  co2            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  fapar          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,         </span>
<span>  kphio          <span class="op">=</span> <span class="fl">0.049977</span>,</span>
<span>  beta           <span class="op">=</span> <span class="fl">146</span>,</span>
<span>  c4             <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method_jmaxlim <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  do_soilmstress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose        <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in sqrt((1/fact_jmaxlim)^2 - 1): NaNs produced</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out_ts_pmodel</span><span class="op">$</span><span class="va">gpp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 8.162522 7.967237 8.148933 7.468270 8.968635</span></span></code></pre>
<p>Note that <code>gpp</code> (as well as all other returned variables)
are now vectors of the same length as the vectors provided as
inputs.</p>
</div>
<div class="section level3">
<h3 id="p-model-in-the-tidyverse">P-model in the tidyverse<a class="anchor" aria-label="anchor" href="#p-model-in-the-tidyverse"></a>
</h3>
<p>We can create a data frame (in <a href="https://www.tidyverse.org/" class="external-link">tidyverse</a> this is a tibble) and
apply the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> function to each row.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1982</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  co2            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  fapar          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> out_pmodel <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">rpmodel</span>, </span>
<span>    elv            <span class="op">=</span> <span class="fl">0</span>,         </span>
<span>    kphio          <span class="op">=</span> <span class="fl">0.049977</span>,</span>
<span>    beta           <span class="op">=</span> <span class="fl">146</span>,</span>
<span>    c4             <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    method_jmaxlim <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    do_ftemp_kphio <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p>Note that the new column <code>out_pmodel</code> now contains the
list returned as output of the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> function applied
to each row separately. Additional (constant) arguments are just passed
to <code><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">purrr::pmap</a></code> as arguments.</p>
<p>If you prefer the elements of these lists to be in separate columns
of <code>df</code>, use tidyr to do:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> out_pmodel <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">out_pmodel</span>, <span class="op">~</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">out_pmodel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c4-photosynthesis">C4 photosynthesis<a class="anchor" aria-label="anchor" href="#c4-photosynthesis"></a>
</h3>
<p>Photosynthesis by C4 plants is simulated by the P-model based on the
assumption that the “CO2 limitation term” in the FvCB model (Eq. 11 in
Stocker et al., 2020) is 1 (no limitation), and based on a distinct
parametrisation of the quantum yield efficiency and its temperature
dependence <span class="math inline">\(\varphi_0\)</span>, following Cai
&amp; Prentice, 2020. Under identical conditions, GPP of C3 and C4
photosynthesis are different:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_c3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  c4             <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">out_c4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  c4             <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in rpmodel(tc = 20, vpd = 1000, co2 = 400, fapar = 1, ppfd = 30, : rpmodel(): light and Rubisco-limited assimilation rates are not identical.</span></span>
<span><span class="co">## Mean relative difference: 1.582923</span></span></code></pre>
<pre><code><span><span class="co">## Warning in rpmodel(tc = 20, vpd = 1000, co2 = 400, fapar = 1, ppfd = 30, : rpmodel(): Assimilation and GPP are not identical.</span></span>
<span><span class="co">## Mean relative difference: 1.582923</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out_c3</span><span class="op">$</span><span class="va">gpp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 7.642545</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out_c4</span><span class="op">$</span><span class="va">gpp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 126.2565</span></span></code></pre>
<p>To accurately simulate C3 photosynthesis, a constant scalar was
calibrated by Stocker et al., 2020 to GPP from FLUXNET2015 data and
scaled in their ‘BRC’ and ‘FULL’ setup with a temperature dependence
factor (their Eq. 20). The implementation of C3 photosynthesis in
rpmodel uses <code>kphio</code> as a constant scalar, provided to
<code><a href="../reference/rpmodel.html">rpmodel()</a></code> as an argument, and representing <span class="math inline">\((a_L b_L)/4\)</span> in their Eq. 20. The
temprature dependence is calculated based on Bernacchi et al., 2003
using the function <code><a href="../reference/ftemp_kphio.html">ftemp_kphio()</a></code>.</p>
<p>The implementation of C4 photosynthesis uses a different temperature
dependence of <span class="math inline">\(\varphi_0\)</span> following
Eq. 5 in Cai &amp; Prentice (2020), implemented by
<code>ftemp_kphio(c4 = TRUE)</code>. The calibratable parameter
<code>kphio</code> doesn’t appear explicitly in Eq. 5 by Cai &amp;
Prentice (2020), but is implemented the same way in rpmodel as for C3
photosynthesis. It should therefore be regarded as a “correction”
factor, where <code>kphio = 1.0</code> means “no correction” and
reflects the parametrisation used by Cai &amp; Prentice (2020).</p>
<p>The following shows <span class="math inline">\(\varphi(T)\)</span>,
corresponding to <code>kphio * ftemp_kphio()</code>, using parameters as
in Stocker et al., 2020 for C3 vegetation (their ‘BRC’ setup, black line
in the plot below), and as in Cai &amp; Prentice (2020) for C4
vegetation (blue solid line).</p>
<p>Addendum: As of <a href="https://github.com/computationales/rpmodel/issues/19" class="external-link">issue
#19</a> (raised by David Orme), the values provided in Cai &amp;
Prentice (2020) are erroneous. And instead, the temperature response
function for C4 should be
<code>ftemp = -0.064 + 0.03 * tc - 0.000464 * tc^2</code>. This is now
also implemented in rpmodel.</p>
</div>
</div>
<div class="section level2">
<h2 id="auxiliary-functions">Auxiliary functions<a class="anchor" aria-label="anchor" href="#auxiliary-functions"></a>
</h2>
<p>A number of auxiliary functions, which are used within
<code><a href="../reference/rpmodel.html">rpmodel()</a></code>, are available (public) through the package.</p>
<div class="section level3">
<h3 id="instantaneous-temperature-scaling">Instantaneous temperature scaling<a class="anchor" aria-label="anchor" href="#instantaneous-temperature-scaling"></a>
</h3>
<p>Different instantaneous temperature scaling functions are applied for
<span class="math inline">\(V_\text{cmax}\)</span> and dark respiration
(<span class="math inline">\(R_d\)</span>).</p>
<ul>
<li>
<code><a href="../reference/ftemp_inst_vcmax.html">ftemp_inst_vcmax()</a></code> calculates the instantaneous
temperature response of <span class="math inline">\(V_\text{cmax}\)</span>. Let’s run the P-model for
<code>tc = 10</code> (degrees C). The ratio of <span class="math inline">\(V_\text{cmax}/V_\text{cmax25}\)</span> should
equal the instantaneous temperature scaling function for <span class="math inline">\(V_\text{cmax}\)</span> at 10 degrees C (calculated
by <code>ftemp_inst_vcmax(10)</code>):</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_pmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">10</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  kphio          <span class="op">=</span> <span class="fl">0.049977</span>,     <span class="co"># quantum yield efficiency as calibrated for setup ORG by Stocker et al. 2020 GMD,</span></span>
<span>  beta           <span class="op">=</span> <span class="fl">146</span>,          <span class="co"># unit cost ratio a/b,</span></span>
<span>  method_jmaxlim <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose        <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in rpmodel(tc = 10, vpd = 1000, co2 = 400, fapar = 1, ppfd = 30, : Atmospheric pressure (patm) not provided. Calculating it as a</span></span>
<span><span class="co">##       function of elevation (elv), assuming standard atmosphere </span></span>
<span><span class="co">##       (101325 Pa at sea level).</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Ratio Vcmax/Vcmax25      :"</span>, <span class="va">out_pmodel</span><span class="op">$</span><span class="va">vcmax</span><span class="op">/</span><span class="va">out_pmodel</span><span class="op">$</span><span class="va">vcmax25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Ratio Vcmax/Vcmax25      : 0.260975632963417"</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"ftemp_inst_vcmax(10):"</span>, <span class="fu"><a href="../reference/ftemp_inst_vcmax.html">ftemp_inst_vcmax</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ftemp_inst_vcmax(10): 0.260975632963417"</span></span></code></pre>
<ul>
<li><p><code><a href="../reference/ftemp_arrh.html">ftemp_arrh()</a></code> Calculates the Arrhenius-type
temperature response and is used inside
<code><a href="../reference/ftemp_inst_vcmax.html">ftemp_inst_vcmax()</a></code>.</p></li>
<li><p><code><a href="../reference/ftemp_inst_rd.html">ftemp_inst_rd()</a></code> calculates the temperature response
of dark respiration (<span class="math inline">\(R_d\)</span>), which is
slightly less steep than that for <span class="math inline">\(V_\text{cmax}\)</span>:</p></li>
</ul>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"ftemp_inst_rd(10):"</span>, <span class="fu"><a href="../reference/ftemp_inst_rd.html">ftemp_inst_rd</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ftemp_inst_rd(10): 0.284933345928884"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="parameters-in-the-fvcb-model">Parameters in the FvCB model<a class="anchor" aria-label="anchor" href="#parameters-in-the-fvcb-model"></a>
</h3>
<ul>
<li>
<code><a href="../reference/calc_gammastar.html">calc_gammastar()</a></code> calculates the CO<span class="math inline">\(_2\)</span> compensation point (<span class="math inline">\(\Gamma^\ast\)</span>) in the Farquhar-von
Caemmerer-Berry model as a function of temperature (argument
<code>tc</code>) and atmospheric pressure (argument <code>patm</code>).
This is returned by the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> function and by the
separate auxiliary function <code><a href="../reference/calc_gammastar.html">calc_gammastar()</a></code>.
<code><a href="../reference/calc_gammastar.html">calc_gammastar()</a></code> requires atmospheric pressure
(<code>patm</code>) to be given as an argument (in addition to
temperature). Corresponding to the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> call above,
let’s calculate this using the auxiliary function
<code><a href="../reference/calc_patm.html">calc_patm()</a></code> with 0 metres above sea level, and assuming
standard atmospheric pressure (101325 Pa at 0 m a.s.l.):</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"From rpmodel call :"</span>, <span class="va">out_pmodel</span><span class="op">$</span><span class="va">gammastar</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "From rpmodel call : 1.93016150706341"</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"gammastar(10):"</span>, <span class="fu"><a href="../reference/calc_gammastar.html">calc_gammastar</a></span><span class="op">(</span><span class="fl">10</span>, patm <span class="op">=</span> <span class="fu"><a href="../reference/calc_patm.html">calc_patm</a></span><span class="op">(</span>elv <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "gammastar(10): 1.93016150706341"</span></span></code></pre>
<ul>
<li>
<code><a href="../reference/calc_kmm.html">calc_kmm()</a></code> calculates the Michaelis Menten coefficient
for Rubisco-limited photosynthesis as a function of temperature
(argument <code>tc</code>) and atmospheric pressure (argument
<code>patm</code>). As above, <code><a href="../reference/calc_kmm.html">calc_kmm()</a></code> requires
atmospheric pressure to be given as an argument (in addition to
temperature). Corresponding to the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> call above,
let’s calculate this using the auxiliary function
<code><a href="../reference/calc_patm.html">calc_patm()</a></code> with 0 metres above sea level, and assuming
standard atmospheric pressure (101325 Pa at 0 m a.s.l.):</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"From rpmodel call:"</span>, <span class="va">out_pmodel</span><span class="op">$</span><span class="va">kmm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "From rpmodel call: 19.6242174524746"</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"kmm(10)     :"</span>, <span class="fu"><a href="../reference/calc_kmm.html">calc_kmm</a></span><span class="op">(</span><span class="fl">10</span>, patm <span class="op">=</span> <span class="fu"><a href="../reference/calc_patm.html">calc_patm</a></span><span class="op">(</span>elv <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "kmm(10)     : 19.6242174524746"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="temperature-dependence-of-quantum-yield-efficiency">Temperature dependence of quantum yield efficiency<a class="anchor" aria-label="anchor" href="#temperature-dependence-of-quantum-yield-efficiency"></a>
</h3>
<p>The temperature dependence of quantum yield efficiency is modelled
following Bernacchi et al. (2003), if the argument to the
<code><a href="../reference/rpmodel.html">rpmodel()</a></code> call <code>do_ftemp_kphio = TRUE</code>. This
affects several quantities returned by the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> call
(GPP, LUE, Vcmax), and can be calculated direction using
<code><a href="../reference/ftemp_kphio.html">ftemp_kphio()</a></code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_pmodel_ftemp_kphio_ON</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">out_pmodel_ftemp_kphio_OFF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"LUE ftemp_ON /LUE ftemp_OFF ="</span>, <span class="va">out_pmodel_ftemp_kphio_ON</span><span class="op">$</span><span class="va">lue</span> <span class="op">/</span> <span class="va">out_pmodel_ftemp_kphio_OFF</span><span class="op">$</span><span class="va">lue</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "LUE ftemp_ON /LUE ftemp_OFF = "</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"GPP ftemp_ON /GPP ftemp_OFF ="</span>, <span class="va">out_pmodel_ftemp_kphio_ON</span><span class="op">$</span><span class="va">gpp</span> <span class="op">/</span> <span class="va">out_pmodel_ftemp_kphio_OFF</span><span class="op">$</span><span class="va">gpp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "GPP ftemp_ON /GPP ftemp_OFF = 1.07351301598735"</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Vcmax ftemp_ON /Vcmax ftemp_OFF ="</span>, <span class="va">out_pmodel_ftemp_kphio_ON</span><span class="op">$</span><span class="va">vcmax</span> <span class="op">/</span> <span class="va">out_pmodel_ftemp_kphio_OFF</span><span class="op">$</span><span class="va">vcmax</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Vcmax ftemp_ON /Vcmax ftemp_OFF = 1.07351301598735"</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"ftemp_kphio(20) ="</span>, <span class="fu"><a href="../reference/ftemp_kphio.html">ftemp_kphio</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ftemp_kphio(20) = 0.656"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="soil-moisture-stress">Soil moisture stress<a class="anchor" aria-label="anchor" href="#soil-moisture-stress"></a>
</h3>
<p>The soil moisture stress function is available as a separate public
function.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec_soilm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1.0</span>, to <span class="op">=</span> <span class="fl">0.0</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">vec_soilmstress</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_soilmstress.html">calc_soilmstress</a></span><span class="op">(</span> <span class="va">vec_soilm</span>, meanalpha <span class="op">=</span> <span class="fl">1.0</span>, apar_soilm <span class="op">=</span> <span class="fl">0.0</span>, bpar_soilm <span class="op">=</span> <span class="fl">0.7330</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vec_soilm</span>, <span class="va">vec_soilmstress</span><span class="op">)</span></span></code></pre></div>
<p><img src="usage_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Similar to above, the soil moisture dependence of LUE (and hence GPP,
and Vcmax) can be calculated directly using the function
<code><a href="../reference/calc_soilmstress.html">calc_soilmstress()</a></code> and affects several quantities returned
by the <code><a href="../reference/rpmodel.html">rpmodel()</a></code> call (GPP, LUE, Vcmax):</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_pmodel_soilmstress_OFF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  do_soilmstress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">out_pmodel_soilmstress_ON</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rpmodel.html">rpmodel</a></span><span class="op">(</span> </span>
<span>  tc             <span class="op">=</span> <span class="fl">20</span>,           <span class="co"># temperature, deg C</span></span>
<span>  vpd            <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Pa,</span></span>
<span>  co2            <span class="op">=</span> <span class="fl">400</span>,          <span class="co"># ppm,</span></span>
<span>  fapar          <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># fraction  ,</span></span>
<span>  ppfd           <span class="op">=</span> <span class="fl">30</span>,           <span class="co"># mol/m2/d,</span></span>
<span>  elv            <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># m.a.s.l.,</span></span>
<span>  do_ftemp_kphio <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  do_soilmstress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  soilm          <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  apar_soilm     <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  bpar_soilm     <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  meanalpha      <span class="op">=</span> <span class="fl">0.2</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"LUE soilmstress_ON /LUE soilmstress_OFF ="</span>, <span class="va">out_pmodel_soilmstress_ON</span><span class="op">$</span><span class="va">lue</span> <span class="op">/</span> <span class="va">out_pmodel_soilmstress_OFF</span><span class="op">$</span><span class="va">lue</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "LUE soilmstress_ON /LUE soilmstress_OFF = "</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"GPP soilmstress_ON /GPP soilmstress_OFF ="</span>, <span class="va">out_pmodel_soilmstress_ON</span><span class="op">$</span><span class="va">gpp</span> <span class="op">/</span> <span class="va">out_pmodel_soilmstress_OFF</span><span class="op">$</span><span class="va">gpp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "GPP soilmstress_ON /GPP soilmstress_OFF = 0.662222222222222"</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Vcmax soilmstress_ON /Vcmax soilmstress_OFF ="</span>, <span class="va">out_pmodel_soilmstress_ON</span><span class="op">$</span><span class="va">vcmax</span> <span class="op">/</span> <span class="va">out_pmodel_soilmstress_OFF</span><span class="op">$</span><span class="va">vcmax</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Vcmax soilmstress_ON /Vcmax soilmstress_OFF = 0.662222222222222"</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"soilmstress(0.2, apar_soilm = 0.1, bpar_soilm = 0.7, meanalpha = 0.2) ="</span>, <span class="fu"><a href="../reference/calc_soilmstress.html">calc_soilmstress</a></span><span class="op">(</span><span class="fl">0.2</span>, apar_soilm <span class="op">=</span> <span class="fl">0.1</span>, bpar_soilm <span class="op">=</span> <span class="fl">0.7</span>, meanalpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "soilmstress(0.2, apar_soilm = 0.1, bpar_soilm = 0.7, meanalpha = 0.2) = 0.662222222222222"</span></span></code></pre>
<p><code><a href="../reference/ftemp_arrh.html">ftemp_arrh()</a></code> Calculates the Arrhenius-type temperature
response.</p>
<!-- ## Response to CO2 -->
<!-- ```{r} -->
<!-- library(ggplot) -->
<!-- df <- tibble( -->
<!--   tc             = rep(20, 100), -->
<!--   vpd            = rep(1000, 100), -->
<!--   co2            = seq(360, 1000, length.out = 100), -->
<!--   fapar          = rep(1, 100), -->
<!--   ppfd           = rep(100, 100) -->
<!--   ) %>% -->
<!--   dplyr::mutate( out_pmodel_simpl = purrr::pmap(., rpmodel, -->
<!--     elv            = 0, -->
<!--     kphio          = 0.05, -->
<!--     beta           = 146, -->
<!--     method_optci   = "prentice14", -->
<!--     method_jmaxlim = "none", -->
<!--     do_ftemp_kphio = FALSE -->
<!--     ) ) %>% -->
<!--   dplyr::mutate( out_pmodel_full = purrr::pmap(dplyr::select(., 1:5), rpmodel,  -->
<!--     elv            = 0,          -->
<!--     kphio          = 0.05,          -->
<!--     beta           = 146, -->
<!--     method_optci   = "prentice14", -->
<!--     method_jmaxlim = "wang17", -->
<!--     do_ftemp_kphio = FALSE -->
<!--     ) ) %>%  -->
<!--   dplyr::mutate( out_pmodel_simpl = purrr::map(out_pmodel_simpl, ~as_tibble(.))) %>% -->
<!--   dplyr::mutate( out_pmodel_full  = purrr::map(out_pmodel_full,  ~as_tibble(.))) -->
<!-- df %>%  -->
<!--   tidyr::unnest(out_pmodel_full) %>%  -->
<!--   dplyr::select(co2, out_pmodel_simpl, gpp_full = gpp) %>%  -->
<!--   tidyr::unnest(out_pmodel_simpl) %>%  -->
<!--   dplyr::select(co2, gpp_full, gpp_simpl = gpp) %>%  -->
<!--   tidyr::gather(method, gpp, c(gpp_full, gpp_simpl)) %>%  -->
<!--   ggplot(aes(x = co2, y = gpp, color = method)) + -->
<!--   geom_line() -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bernacchi, C. J., Pimentel, C., and Long, S. P.: In vivo temperature
response func-tions of parameters required to model RuBP-limited
photosynthesis, Plant Cell Environ., 26, 1419–1430, 2003</p>
<p>Cai, W., and Prentice, I. C.: Recent trends in gross primary
production and their drivers: analysis and modelling at flux-site and
global scales, Environ. Res. Lett. 15 124050 <a href="https://doi.org/10.1088/1748-9326/abc64e" class="external-link uri">https://doi.org/10.1088/1748-9326/abc64e</a>, 2020</p>
<p>Stocker, B. D., Wang, H., Smith, N. G., Harrison, S. P., Keenan, T.
F., Sandoval, D., Davis, T., and Prentice, I. C.: P-model v1.0: An
optimality-based light use efficiency model for simulating ecosystem
gross primary production, Geosci. Model Dev. Discuss., <a href="https://doi.org/10.5194/gmd-2019-200" class="external-link uri">https://doi.org/10.5194/gmd-2019-200</a>, in review,
2019.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/computationales" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://computationales.ethz.ch/" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://computationales.ethz.ch/" class="external-link">Computationales</a></li>
                            <li><a href="https://computationales.ethz.ch/" class="external-link">Our Team</a></li>
                            <li><a href="https://computationales.ethz.ch/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/computationales" class="external-link">Packages</a></li>
                            <li><a href="https://computationales.ethz.ch/" class="external-link">Publications</a></li>
                            <li><a href="https://computationales.ethz.ch/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  


  

  </body>
</html>
